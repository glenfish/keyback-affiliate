<script is:inline>
  var newPricing = '';
  var isAffiliate = false;
  var myMap;
  function setCookie(e, t, o) {
    const n = new Date();
    n.setTime(n.getTime() + 24 * o * 60 * 60 * 1e3);
    let s = 'expires=' + n.toUTCString();
    document.cookie = e + '=' + t + ';' + s + ';path=/' + ';domain=.keyback.io' + ';Samesite=Lax';
  }

  function convert(json) {
    myMap = new Map(Object.entries(JSON.parse(json)));
  }

  var returnedData;
  var clickID = '';
  const API_URL_CLICK = 'https://app.keyback.io/api/tapfiliate/click-id?';
  function getClickID(params) {
    fetch(API_URL_CLICK + params, {
      method: 'GET',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': 'https://specials.keyback.io',
      },
    })
      .then((response) => response.json())
      // .then(data => {console.log('CLICK ID: ' + data.data.id)} )
      .then((data) => {
        setCookie('click_id', data.data.id, 90);
      })

      // .then(data => console.log(data))
      // .then(data => convert(data))
      .catch((error) => console.error(error));
  }

  const API_URL_PRICING = 'https://app.keyback.io/api/coupons/discount-by-ref/';
  function getPricing(params) {
    fetch(API_URL_PRICING + params, {
      method: 'GET',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': 'https://specials.keyback.io',
      },
    })
      .then((response) => response.json())
      .then((data) => {
        // console.log('price: ' + data.data.discounted_price);
        newPricing = data.data.discounted_price;
        // console.log(newPricing);
        document.getElementById('price1').textContent = newPricing;
        document.getElementById('price2').textContent = newPricing;
      })

      // .then(data => console.log(data))
      // .then(data => convert(data))
      .catch((error) => console.error(error));
  }

  let urlParams = '';
  const landingPage = window.location.href;

  document.addEventListener('DOMContentLoaded', () => {
    const e = new URLSearchParams(window.location.search),
      t = Array.from(e.keys()).reduce(
        (t, o) => ({
          ...t,
          [o]: e.get(o),
        }),
        {}
      );
    // console.log(t);
    var refResult = '';
    const referringURL = window.location.href;
    if (referringURL.includes('specials.keyback.io/go/')) {
      refResult = referringURL.replace('https://specials.keyback.io/go/', '');
      // console.log('Go Referrer: ' + refResult);
    }
    if (referringURL.includes('specials.keyback.io/pro/')) {
      refResult = referringURL.replace('https://specials.keyback.io/pro/', '');
      // console.log('Pro Referrer: ' + refResult);
    }
    if (refResult != '') {
      urlParams += 'referral_code=' + refResult + '&';
      setCookie('ref', refResult, 90);
      isAffiliate = true;
    }

    urlParams += 'referrer=' + encodeURIComponent(document.referrer) + '&';
    urlParams += 'landing_page=' + encodeURIComponent(landingPage);

    if (isAffiliate) {
      getClickID(urlParams);
      getPricing(refResult);
    }
  });
</script>
