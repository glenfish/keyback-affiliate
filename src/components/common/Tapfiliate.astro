<script is:inline>
  var myMap;
  var isAffiliate = false;
  function setCookie(e, t, o) {
    const n = new Date();
    n.setTime(n.getTime() + 24 * o * 60 * 60 * 1e3);
    let s = 'expires=' + n.toUTCString();
    document.cookie = e + '=' + t + ';' + s + ';path=/' + ';domain=.keyback.io' + ';Samesite=Lax';
  }

  function convert(json) {
    myMap = new Map(Object.entries(JSON.parse(json)));
  }

  var returnedData;
  var clickID = '';
  const API_URL = 'https://app.keyback.io/api/tapfiliate/click-id?';
  function sendParams(params) {
    fetch(API_URL + params, {
      method: 'GET',
      mode: 'cors',
      headers: {
        'Content-Type': 'application/json',
        'Access-Control-Allow-Origin': 'https://keyback.io',
      },
    })
      .then((response) => response.json())
      // .then(data => {console.log('CLICK ID: ' + data.data.id)} )
      .then((data) => {
        setCookie('click_id', data.data.id, 90);
      })

      // .then(data => console.log(data))
      // .then(data => convert(data))
      .catch((error) => console.error(error));
  }

  let urlParams = '';
  const landingPage = 'https://keyback.io';

  document.addEventListener('DOMContentLoaded', () => {
    const e = new URLSearchParams(window.location.search),
      t = Array.from(e.keys()).reduce(
        (t, o) => ({
          ...t,
          [o]: e.get(o),
        }),
        {}
      );
    console.log(t);

    let o = '';
    Object.keys(t).forEach((e) => {
      if (e == 'ref') {
        urlParams += 'referral_code=' + t[e] + '&';
        setCookie('ref', t[e], 90);
        isAffiliate = true;
      } else {
        urlParams += e + '=' + t[e] + '&';
      }
      //   setCookie("kb_" + e, t[e], 90), o += "kb_" + e + " ",
      //   console.log("kb_" + e, t[e])
    }),
      //  setCookie("kb_keylist", o, 90)
      (urlParams += 'referrer=' + encodeURIComponent(document.referrer) + '&');
    urlParams += 'landing_page=' + encodeURIComponent(landingPage);
    console.log(urlParams);

    if (isAffiliate) {
      sendParams(urlParams);
    }
  });
</script>
